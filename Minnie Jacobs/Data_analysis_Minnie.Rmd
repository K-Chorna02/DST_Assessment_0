---
title: "WHO_analysis"
author: "Minnie"
date: "2025-09-29"
output: html_document
---

## Introduction 

Throughout this project, we explore data relevant to environmetal health analysis, focusing on air pollution data from the World Health Organisation. This information can be particularly relevant when identifying areas with high pollutants, trends in pollutant concentrations over time and relationships between pollutants. By exploring this data, we hope to gain an insight into some of these trends, which in a real life scenario could contribute to research in policy making to address these issues.
We perform a literature review of resources for helping us analyse our data set, alongside using our own knowledge of EDA and exploring built in R packages. 
We will walk through how we cleaned and prepared our data, carried out EDA and found ways to visualise the trends we were able to find from this. 

## Uploading and cleaning data
Since our data is sorced from the World Health Organisation, we can say with confidence that this data was reliably sourced. We begin by loading our data into R, as follows:

```{r load}
data=read.csv("who_data.csv")
```

Next, cleaning and filtering, we removed unneccesary columns to focus on the key aspects of the dataset. It is always good to start by looking at the summary data to get an overview of our trends and identify issues.

```{r summaries}
#We deleted the columns that were irrelevant.
data_new=subset(data,select=-c(X,X.1,X.2,X.3,who_ms))
summary(data_new)

```

As we can see we have a range of different types of data:
- *Numerical:* Population counts and pollutant concentrations pm10, pm25, no2. There are something we will focus on throughout our project. 
-*Temporal: * Year 2010-2022. Time is an important variable when exploring long term changes in concentration of pollutants and can help illustrate trends or patterns.
-*Categorical:* Country, city, station type
- Spatial: Longitude and latitude coordinates (could be useful in determining whether  parts of the world have a trend in a higher concentration of pollutants.)

There is also a very large range for variables such as no2 concentration. First we consider reasons for these spikes, they could be measurement error or extreme pollution events as a consequence of natural disasters.A good approach to deal with the large ranges is to scale the data, for example, using a log transformation, or we could identify some as outliers and cap the values.
We also notice a large number of NA values for each category. We could remove missing data and cap values to avoid extreme outliers, but we might not want to dismiss all the missing data as we could accidentally introduce bias.

## Dealing with missing data
We explore to see if there is a trend in missing data, e.g. one country has more missing data than another, to do so we identify *How many NA's in pm10, pm25 and no2 for each country?* This way we can decide which countries to focus on for our analysis.
```{r pm10 NA count} 

library(dplyr)
data_new %>%
  group_by(country_name) %>%
  summarise(
    na_count = sum(is.na(pm10_concentration)),
    count= n(),
    proportion=na_count/count) %>%
  filter(proportion< 0.3 & count>500)

library(dplyr)
data_new %>%
  group_by(country_name) %>%
  summarise(
    na_count = sum(is.na(pm25_concentration)),
    count= n(),
    proportion=na_count/count) %>%
  filter(proportion< 0.3 & count>100)

library(dplyr)
data_new %>%
  group_by(country_name) %>%
  summarise(
    na_count = sum(is.na(no2_concentration)),
    count= n(),
    proportion=na_count/count) %>%
  filter(proportion< 0.3 & count>500)
```

So here we have decided to look at countries that have over 500 data entries and of these, less than 30% of them are NAs. For no2 we considered a lower threshold of over 100 data entries as we have less data collected.
Instead of focusing on just the data we want to include, we might consider not including countries who are missing 85% of their data, so could carry out a similar process for proportion>0.85. Countries with less than 85% of their data will not be truly representative of pollution in that area, so we could remove them.
```{r data we might not include}

library(dplyr)
data_new %>%
  group_by(city) %>%
  summarise(
    na_count = sum(is.na(pm10_concentration)),
    count    = n(),
    proportion=na_count/count) %>%
  filter(proportion < 0.85)
```

Using this information regarding missing values, we want to use the top 10 most relevant countries, or rather the countries with the highest proportion of usable data in our analysis. 
For the pm10 analysis we had to decide between what was more important, having a higher count rate but smaller proportion, or having less missing values with less data. We concluded that having more data would be significant in representing each country.

# Creating subsets based on missing data 
```{r most relevant } 
pm10_top_10= data_new %>%
  filter(country_name %in%
c("Austria","Belgium", "Bulgaria", "Czechia","France","Germany","Italy","Netherlands (Kingdom of the)", "Poland","Switzerland"))
pm25_top_10= data_new %>%
  filter(country_name %in% c("Australia","Canada","Chile","China","Norway","Slovakia","South Africa","United States of America"))
no2_top_10= data_new %>%
  filter(country_name %in%
c("Austria","Belgium","France","Germany","Israel","Italy","Spain","Sweden","Switzerland","United Kingdom of Great Britain and Northern Ireland"))
```
Here we manually selected the 10 most relevant countries, or 8 in the case of pm25. Now it is time to use this data to explore the relationship between country and particle matter concentrations over time. Below we have created a time series plot for concentrtions of pm10 in Germany. 

```{r pm10 Germany} 
library(ggplot2)
library(dplyr)
germany_data=data_new %>%
  filter(country_name == "Germany")

ggplot(germany_data, aes(x = year, y = pm10_concentration)) +
  geom_point(color ="black", size = 1) +
  labs(
    title = "pm10 concentration by year in Germany",x = "Year",y = "Germany pm10 concentration")
```
Evidently there is a clear trend in Germany's pm10 concentration over time, if we were to explore this further we could fit a line of best fit to identify at what rate the particle concentration is decreasing over time. 
Using our subsets we created, we can create time series plots for all of them simultaneously, using facet_wrap. 

# Time series plot 
We use ggplot2 as this is a very useful R package for creating data visualisations.
```{r pm10 top countries} 
library(ggplot2)
pm10_top_10 %>%
  ggplot(aes(x = year, y = pm10_concentration)) +
  geom_point(color = "black", size = 1) +
  facet_wrap(~ country_name, scales = "free_y") +
  labs(title = "PM10 concentration by top 10 countries",x = "Year",y = "PM10 concentration"
  )
```


```{r pm25 top countries} 
library(ggplot2)
pm25_top_10 %>%
  ggplot(aes(x = year, y = pm10_concentration)) +
  geom_point(color = "black", size = 1) +
  facet_wrap(~ country_name, scales = "free_y") +
  labs(
    title = "PM25 concentration by top 10 countries",
    x = "Year",
    y = "PM25 concentration"
  )
```

```{r no2 top countries} 
library(ggplot2)
no2_top_10 %>%
  ggplot(aes(x = year, y = pm10_concentration)) +
  geom_point(color = "black", size = 1) +
  facet_wrap(~ country_name, scales = "free_y") +
  labs(
    title = "No2 concentration by top 10 countries",
    x = "Year",
    y = "No2 concentration"
  )
```
From this we can see there is a clear downward sloping linear trend in most countries. Interestingly 2011 seems to provide missingdata for most countries, so perhaps we could only focus on years from 2011 onwards in our analysis. 

## Built in R packages 

To further explore the relationshp between time and concentration between country, we decided to explore built in packages in RStudio and see which were relevant to our project. After careful research, we came across the "openair" package, which is particularly relevant to air pollutant data. 
Carslaw, D. C., & Ropkins, K. (2012). openair — An R package for air quality data analysis.
Environmental Modelling & Software, 27–28, 52–61. https://doi.org/10.1016/j.envsoft.2011.09.008

Included in this package is TimePlot, which we decided to use to compare to our scatter plots. lLubridate is also used to deal with time handling

```{r openair}
#install.packages("openair")

library(openair)
library(dplyr)
library(lubridate)

data_openair_country= pm10_top_10 %>%
  filter(!is.na(year)) %>%
  group_by(country_name, year) %>%
  summarise(
    pm25 = mean(pm25_concentration, na.rm = TRUE),
    pm10 = mean(pm10_concentration, na.rm = TRUE),
    no2  = mean(no2_concentration, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(date = ymd(paste0(year, "-06-30"))) %>%  # because of the nature of this package, we have to generate a date for each year
  select(date, country_name, pm25, pm10, no2)
timePlot(data_openair_country,pollutant = c("pm25", "pm10", "no2"),
         type = "country_name",
         main = "Annual pm25 and no2 trends by Country")

```
This creates a very clear visualisation of all 3 particle matter types, though the scale is harder to read, I believe these provide a clear insight into the trends, which are obviously negatively correlated. 

```{r pm25 openair}
library(openair)
library(dplyr)
library(lubridate)

data_openair_country= pm25_top_10 %>%
  filter(!is.na(year)) %>%
  group_by(country_name, year) %>%
  summarise(
    pm25 = mean(pm25_concentration, na.rm = TRUE),
    pm10 = mean(pm10_concentration, na.rm = TRUE),
    no2  = mean(no2_concentration, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(date = ymd(paste0(year, "-06-30"))) %>%
  select(date, country_name, pm25, pm10, no2)
timePlot(data_openair_country,
         pollutant = c("pm25", "pm10", "no2"),
         type = "country_name",
         main = "Annual PM2.5 and NO2 Trends by Country")
```

```{r no2 openair}
library(openair)
library(dplyr)
library(lubridate)

data_openair_country=no2_top_10 %>%
  filter(!is.na(year)) %>%
  group_by(country_name, year) %>%
  summarise(
    pm25 = mean(pm25_concentration, na.rm = TRUE),
    pm10 = mean(pm10_concentration, na.rm = TRUE),
    no2  = mean(no2_concentration, na.rm = TRUE),
    .groups = "drop"
  ) %>%
  mutate(date = ymd(paste0(year, "-06-30"))) %>%  
  select(date, country_name, pm25, pm10, no2)

timePlot(data_openair_country,
         pollutant = c("pm25", "pm10", "no2"),
         type = "country_name",
         main = "Annual PM2.5 and NO2 Trends by Country")
```

# Conclusion

After extensive exploration of our data, we can conclude that there is a general decline in pollutant concentrations over time in most European countries (from 2015 onwards). We explored 2 different methods when creating time plots, by using ggplot and by using built in R packages. 
The ggplots were easier to read when picking out key information such as year and specific concentration. However for exploring trends, openair was very useful as it provided a clear visual representation of all concentrations- making it easy to compare between countries and across different particle types.



